<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Detail View | Ganesh Partheeban</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #FFFDF3;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Smooth transitions */
        .gallery-item {
            transition: opacity 0.3s ease, transform 0.3s ease;
            height: 82px;
            width: 145px;
            border-radius: 8.64px;
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item.selected {
            position: relative;
        }

        .gallery-item.selected::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 8.64px;
            pointer-events: none;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Ensure horizontal scrolling works */
        #gallery-container {
            min-width: max-content;
        }
    </style>
</head>

<body class="text-neutral-900 h-screen flex flex-col overflow-hidden bg-[#FFFDF3]">

    <!-- Navigation Header -->
    <header class="fixed top-0 left-0 right-0 z-50 w-full pointer-events-none">
        <div class="absolute left-[28px] top-[24px] pointer-events-auto">
            <a href="index.html" class="text-[16px] font-bold text-[#111] tracking-tight">Ganesh Partheeban</a>
        </div>
        <div class="absolute right-[60px] top-[24px] pointer-events-auto group">
            <button id="close-btn" class="transition-opacity group-hover:opacity-60 text-[18px] font-bold text-[#111] cursor-pointer text-right">
                Close
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="w-full h-screen flex flex-col relative pt-[80px] pb-[120px]">

        <!-- Hero Section - Left Aligned Image -->
        <div class="flex-1 flex items-center pl-[285px] pr-[60px] min-h-0">
            <div class="w-full max-w-[1158px] h-[calc(100vh-280px)] max-h-[772px] rounded-[20px] overflow-hidden flex-shrink-0">
                <img id="main-image" src="" alt="Selected image" class="w-full h-full object-cover rounded-[20px]">
            </div>
        </div>

        <!-- Left Sidebar - Category Label (Vertically Centered with Image) -->
        <div id="category-label-container" class="absolute left-[28px] flex flex-col items-start z-10">
            <h1 id="category-label" class="text-[18px] font-bold tracking-tight text-[#111]">Landscape</h1>
        </div>

        <!-- Bottom Gallery - Left Aligned at bottom -->
        <div id="gallery-scroll-container" class="absolute bottom-[34px] left-[285px] right-[60px] z-20 overflow-x-auto no-scrollbar overflow-y-hidden">
            <div id="gallery-container" class="flex gap-[40px] w-max">
                <!-- Gallery items will be dynamically inserted here -->
            </div>
        </div>

    </main>

    <script>
        lucide.createIcons();

        // Get image index from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const imageIndex = parseInt(urlParams.get('imageIndex')) || 0;

        // Get all images from sessionStorage
        const allImagesData = JSON.parse(sessionStorage.getItem('allImages') || '[]');
        
        // Get scroll position to restore later
        const savedScrollPosition = parseInt(sessionStorage.getItem('scrollPosition') || '0');

        // Category mapping
        const categoryMap = {
            'landscape': 'Landscape',
            'aviation': 'Aviation',
            'fireworks': 'Fireworks',
            'macro': 'Macro',
            'silhouette': 'Silhouette'
        };

        // Position category label to vertically center with main image
        function positionCategoryLabel() {
            const mainImage = document.getElementById('main-image');
            const categoryLabelContainer = document.getElementById('category-label-container');
            
            if (mainImage && categoryLabelContainer) {
                const imageRect = mainImage.getBoundingClientRect();
                const imageCenter = imageRect.top + (imageRect.height / 2);
                const labelHeight = categoryLabelContainer.offsetHeight;
                const topPosition = imageCenter - (labelHeight / 2);
                
                categoryLabelContainer.style.top = `${topPosition}px`;
            }
        }

        // Initialize detail view
        function initializeDetailView() {
            if (allImagesData.length === 0) {
                // Fallback if no data
                document.getElementById('main-image').src = 'Landscape/ganesh-partheeban--ZKb2pjWQZ0-unsplash.jpg';
                setTimeout(positionCategoryLabel, 100);
                return;
            }

            const selectedImage = allImagesData[imageIndex];
            if (!selectedImage) {
                // Fallback if index is out of range
                const firstImage = allImagesData[0];
                document.getElementById('main-image').src = firstImage.src;
                document.getElementById('main-image').alt = firstImage.alt;
                updateCategoryLabel(firstImage.category);
                setTimeout(positionCategoryLabel, 100);
                return;
            }

            // Set main image
            document.getElementById('main-image').src = selectedImage.src;
            document.getElementById('main-image').alt = selectedImage.alt;
            updateCategoryLabel(selectedImage.category);
            
            // Position category label after image loads
            const mainImage = document.getElementById('main-image');
            if (mainImage.complete) {
                setTimeout(positionCategoryLabel, 100);
            } else {
                mainImage.addEventListener('load', () => {
                    setTimeout(positionCategoryLabel, 100);
                });
            }

            // Build gallery
            const galleryContainer = document.getElementById('gallery-container');
            galleryContainer.innerHTML = '';

            allImagesData.forEach((image, index) => {
                const isSelected = index === imageIndex;
                const galleryItem = document.createElement('div');
                galleryItem.className = `gallery-item ${isSelected ? 'selected' : ''}`;
                
                if (!isSelected) {
                    galleryItem.classList.add('hover:opacity-80');
                }

                const img = document.createElement('img');
                img.src = image.src;
                img.alt = image.alt;

                // Add click handler to change main image
                galleryItem.addEventListener('click', () => {
                    if (!isSelected) {
                        // Update main image
                        const mainImage = document.getElementById('main-image');
                        mainImage.src = image.src;
                        mainImage.alt = image.alt;
                        updateCategoryLabel(image.category);

                        // Update selected state in gallery
                        document.querySelectorAll('.gallery-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        galleryItem.classList.add('selected');

                        // Update URL without reload
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('imageIndex', index.toString());
                        window.history.pushState({}, '', newUrl);
                        
                        // Reposition category label after image loads
                        if (mainImage.complete) {
                            setTimeout(positionCategoryLabel, 100);
                        } else {
                            mainImage.addEventListener('load', () => {
                                setTimeout(positionCategoryLabel, 100);
                            }, { once: true });
                        }
                    }
                });

                galleryItem.appendChild(img);
                galleryContainer.appendChild(galleryItem);
            });
        }

        function updateCategoryLabel(category) {
            const categoryName = categoryMap[category] || 'Landscape';
            const categoryLabel = document.getElementById('category-label');
            if (categoryLabel) {
                categoryLabel.textContent = categoryName;
            }
        }

        // Close button handler
        document.getElementById('close-btn').addEventListener('click', () => {
            // Navigate back to index.html
            window.location.href = 'index.html';
        });

        // Restore scroll position when returning to index
        // This will be handled by index.html reading from sessionStorage

        // Initialize on load
        initializeDetailView();

        // Update category label position on window resize
        window.addEventListener('resize', () => {
            positionCategoryLabel();
        });

        // Convert vertical scroll to horizontal scroll for bottom gallery
        const galleryScrollContainer = document.getElementById('gallery-scroll-container');
        if (galleryScrollContainer) {
            galleryScrollContainer.addEventListener('wheel', (e) => {
                // Check if there's horizontal scroll available
                const hasHorizontalScroll = galleryScrollContainer.scrollWidth > galleryScrollContainer.clientWidth;
                
                if (hasHorizontalScroll) {
                    // Prevent default vertical scroll
                    e.preventDefault();
                    
                    // Convert vertical scroll to horizontal
                    galleryScrollContainer.scrollLeft += e.deltaY;
                }
            }, { passive: false });
        }

        // Handle browser back button
        window.addEventListener('popstate', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const newIndex = parseInt(urlParams.get('imageIndex')) || 0;
            if (newIndex !== imageIndex) {
                location.reload();
            }
        });
    </script>

</body>

</html>
